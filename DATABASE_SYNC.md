# Supabase Database Setup and Sync Guide

This guide documents the process used to set up and sync the local project with the remote Supabase database, and provides instructions for future updates.

## Initial Setup Summary

The following actions were taken to establish the connection and schema:

1.  **Verified Environment**: Confirmed `Supabase CLI` availability and identified the project ID (`pfyiwijnmabktyohzudk`) from the `.env` file.
2.  **Installed Dependencies**: Ran `npm install` to ensure all project dependencies, including the local Supabase CLI, were installed.
3.  **Authenticated**: Logged in via the CLI using:
    ```bash
    npx supabase login
    ```
4.  **Linked Project**: Linked the local project to the remote Supabase instance:
    ```bash
    npx supabase link --project-ref pfyiwijnmabktyohzudk
    ```
    *(You will be prompted for your database password)*
5.  **Fixed Migration Script**: Modified `supabase/migrations/20260223080216_initial_schema.sql` to use `gen_random_uuid()` instead of `uuid_generate_v4()` to prevent "function does not exist" errors.
6.  **Pushed Schema**: Applied the database migrations to the remote Supabase project:
    ```bash
    npx supabase db push
    ```

## How to Update the Database

When you make changes to your database schema (e.g., adding tables, columns, or changing types), follow these steps:

### 1. Create a New Migration

Use the Supabase CLI to create a new migration file. Replace `name_of_change` with a descriptive name (e.g., `add_savings_table`).

```bash
npx supabase migration new name_of_change
```

This will create a new SQL file in `supabase/migrations/` (e.g., `20260223120000_name_of_change.sql`).

### 2. Edit the Migration File

Open the newly created SQL file and write your SQL commands (CREATE TABLE, ALTER TABLE, etc.).

Example:
```sql
create table public.savings (
  id bigint generated by default as identity primary key,
  balance numeric(10, 2) default 0,
  updated_at timestamp with time zone default timezone('utc'::text, now())
);
```

### 3. Push Changes to Remote

Once your migration file is ready, push the changes to your remote Supabase database:

```bash
npx supabase db push
```

This command compares your local migrations with the remote database and applies any new pending migrations.

### 4. Pull Changes (Optional)

If changes were made directly on the Supabase Dashboard and you need to sync them locally:

```bash
npx supabase db pull
```

## Common Commands

*   **Check Status**: `npx supabase status` (checks local dev environment)
*   **Start Local Dev**: `npx supabase start`
*   **Stop Local Dev**: `npx supabase stop`

## Change Log

### 2026-02-23: Corrected Default Inventory Items
Created migration `supabase/migrations/20260223090000_correct_inventory_items.sql` to replace placeholder inventory data (Hops, Malt, etc.) with the correct item list requested by the user. This migration truncates the `inventory` table and re-populates it with 0 quantity/value defaults.
